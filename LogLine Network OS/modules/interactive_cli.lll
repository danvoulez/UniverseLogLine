module interactive_cli
version: "1.0.0"

use onboarding_plugplay as ob
use zero_touch_discovery as ztd

flow parse_qr
  inputs: qr
  outputs: { tenant_id: string, token: string }
  steps:
    - let params = url.parse(qr)
    - return { tenant_id: params.tid, token: params.t }

flow cli_wizard
  outputs: { node_id: string }
  steps:
    - print("LogLine Onboarding V3.1 â€¢ Wizard")
    - let mode = prompt_choice("Como conectar?", [
        "ğŸ” Auto-discover (recomendado)",
        "ğŸ“± Scan QR code",
        "ğŸ”‘ Token manual",
        "ğŸ¯ AvanÃ§ado"
      ])
    - match mode:
        0: return ztd.scan_and_join()
        1:
          let qr = prompt("Cole o conteÃºdo do QR: ")
          let p = parse_qr(qr)
          return ob.quickstart_node_mac(p.tenant_id, p.token)
        2:
          let tok = prompt("Token: "); let tid = prompt("Tenant ID: ")
          return ob.quickstart_node_mac(tid, tok)
        3:
          return ob.quickstart_node_mac(prompt("Tenant:"), prompt("Token:"), { hint: "advanced" })
